"use strict";(self.webpackChunkchia_dev_guides=self.webpackChunkchia_dev_guides||[]).push([[8741],{3905:function(e,n,a){a.d(n,{Zo:function(){return d},kt:function(){return u}});var t=a(7294);function f(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function c(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function r(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?c(Object(a),!0).forEach((function(n){f(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function l(e,n){if(null==e)return{};var a,t,f=function(e,n){if(null==e)return{};var a,t,f={},c=Object.keys(e);for(t=0;t<c.length;t++)a=c[t],n.indexOf(a)>=0||(f[a]=e[a]);return f}(e,n);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(t=0;t<c.length;t++)a=c[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(f[a]=e[a])}return f}var o=t.createContext({}),i=function(e){var n=t.useContext(o),a=n;return e&&(a="function"==typeof e?e(n):r(r({},n),e)),a},d=function(e){var n=i(e.components);return t.createElement(o.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var a=e.components,f=e.mdxType,c=e.originalType,o=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=i(a),u=f,b=p["".concat(o,".").concat(u)]||p[u]||s[u]||c;return a?t.createElement(b,r(r({ref:n},d),{},{components:a})):t.createElement(b,r({ref:n},d))}));function u(e,n){var a=arguments,f=n&&n.mdxType;if("string"==typeof e||f){var c=a.length,r=new Array(c);r[0]=p;var l={};for(var o in n)hasOwnProperty.call(n,o)&&(l[o]=n[o]);l.originalType=e,l.mdxType="string"==typeof e?e:f,r[1]=l;for(var i=2;i<c;i++)r[i]=a[i];return t.createElement.apply(null,r)}return t.createElement.apply(null,a)}p.displayName="MDXCreateElement"},2297:function(e,n,a){a.r(n),a.d(n,{assets:function(){return d},contentTitle:function(){return o},default:function(){return u},frontMatter:function(){return l},metadata:function(){return i},toc:function(){return s}});var t=a(3117),f=a(102),c=(a(7294),a(3905)),r=["components"],l={slug:"/crash-course/inner-puzzles",title:"Inner Puzzles"},o=void 0,i={unversionedId:"crash-course/inner-puzzles",id:"crash-course/inner-puzzles",title:"Inner Puzzles",description:"Puzzles all have something in common, they output a list of conditions. This tells the blockchain what you want to do with the coin.",source:"@site/guides/crash-course/inner-puzzles.md",sourceDirName:"crash-course",slug:"/crash-course/inner-puzzles",permalink:"/guides/crash-course/inner-puzzles",draft:!1,editUrl:"https://github.com/Chia-Network/chia-dev-guides/edit/main/guides/crash-course/inner-puzzles.md",tags:[],version:"current",frontMatter:{slug:"/crash-course/inner-puzzles",title:"Inner Puzzles"}},d={},s=[{value:"Inner Puzzles",id:"inner-puzzles",level:2},{value:"Inner Puzzle Creation",id:"inner-puzzle-creation",level:2},{value:"The Steps",id:"the-steps",level:2},{value:"Create the Coin",id:"create-the-coin",level:2},{value:"Crafting a solution",id:"crafting-a-solution",level:2}],p={toc:s};function u(e){var n=e.components,a=(0,f.Z)(e,r);return(0,c.kt)("wrapper",(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,c.kt)("p",null,"Puzzles all have something in common, they output a list of conditions. This tells the blockchain what you want to do with the coin.\nWe did this exact thing in an earlier lesson:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-chialisp"},"(mod (PUBLIC_KEY conditions)\n    (include condition_codes.clib)\n    (include sha256tree.clib)\n\n    (c\n        (list AGG_SIG_ME PUBLIC_KEY (sha256tree conditions))\n        conditions\n    )\n)\n")),(0,c.kt)("p",null,"Here, we are outputting a custom ",(0,c.kt)("inlineCode",{parentName:"p"},"conditions")," which is passed in as a solution."),(0,c.kt)("h2",{id:"inner-puzzles"},"Inner Puzzles"),(0,c.kt)("p",null,"We can create a coin within a coin where the inner coin returns a list of conditions to the outer coin. To do this, we will use ",(0,c.kt)("inlineCode",{parentName:"p"},"(a INNER_PUZZLE inner_solution)"),". The operator ",(0,c.kt)("inlineCode",{parentName:"p"},"a")," means ",(0,c.kt)("inlineCode",{parentName:"p"},"apply")," and is how you execute some code. The inner puzzle will be executed with the inner solution."),(0,c.kt)("p",null,"What the inner puzzle and inner solution is exactly is up to the coin creator. Here is a more complex example for an outer coin:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-chialisp",metastring:'title="outer-puzzle.clsp"',title:'"outer-puzzle.clsp"'},"(mod (PUBLIC_KEY INNER_PUZZLE inner_solution)\n    (include condition_codes.clib)\n    (include sha256tree.clib)\n\n    ; Assert the signature matches and append the conditions.\n    (defun calculate_output (PUBLIC_KEY inner_solution conditions)\n        (c\n            (list AGG_SIG_ME PUBLIC_KEY (sha256tree inner_solution))\n            conditions\n        )\n    )\n\n    ; Pass the output of the inner puzzle to `calculate_output`.\n    (calculate_output PUBLIC_KEY inner_solution (a INNER_PUZZLE inner_solution))\n)\n")),(0,c.kt)("p",null,"This will first run ",(0,c.kt)("inlineCode",{parentName:"p"},"(a INNER_PUZZLE inner_solution)"),", passing the result to our custom function ",(0,c.kt)("inlineCode",{parentName:"p"},"calculate_output"),". This function will require a signature of the outputted conditions from the inner coin."),(0,c.kt)("p",null,"You can think of the outer coin as additional layer to control the inner coin. Almost like a template for your coins."),(0,c.kt)("h2",{id:"inner-puzzle-creation"},"Inner Puzzle Creation"),(0,c.kt)("p",null,"Let's create an inner puzzle. This will use a new condition code ASSERT_HEIGHT_RELATIVE, which will make sure a certain number of blocks have passed since coin creation before the coin can be spent."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-chialisp",metastring:'title="inner-puzzle.clsp"',title:'"inner-puzzle.clsp"'},"(mod (REQUIRED_BLOCKS conditions)\n    (include condition_codes.clib)\n\n    (c\n        (list ASSERT_HEIGHT_RELATIVE REQUIRED_BLOCKS)\n        conditions\n    )\n)\n")),(0,c.kt)("p",null,"We will also need to get the appropriate include files:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"cdv clsp retrieve sha256tree condition_codes\n")),(0,c.kt)("h2",{id:"the-steps"},"The Steps"),(0,c.kt)("admonition",{type:"warning"},(0,c.kt)("p",{parentName:"admonition"},"Many of these values used (such as my public key) are specific to me. I left them in to clearly see command usage, but you'll want to substitute where appropriate.")),(0,c.kt)("p",null,"First, let's get our master public key."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"chia keys show\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"Fingerprint: 1660000549\nMaster public key (m): b8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d\nFarmer public key (m/12381/8444/0/0): b4ef65cc62af8cd6d25e72444e1886938cfec436933cfc5e32c14367f846f6728f74a133c30bbab84fd4d0afec0966a0\nPool public key (m/12381/8444/1/0): b6cb156bad3580795ae9377e717a43925ed7622f18ff6ab8c3471f1fdd18ad9906b8e19c22f25fa29fccbf4af3f4acab\nFirst wallet address: txch1kwa0ach5f3djns83cpvsywnwlx4mjqnzyja3vg0jwlsp3cfwes2qlfdf7c\n")),(0,c.kt)("p",null,"You will specifically want the master public key prefixed with ",(0,c.kt)("inlineCode",{parentName:"p"},"0x"),". For me, this value is:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"0xb8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d\n")),(0,c.kt)("p",null,"Now, let's curry the inner puzzle with some value (in # of blocks)"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"cdv clsp curry inner-puzzle.clsp -a 20\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"(a (q 2 (q 4 (c 2 (c 5 ())) 11) (c (q . 82) 1)) (c (q . 20) 1))\n")),(0,c.kt)("p",null,"Once we've created the bytecode for the inner puzzle, we will curry that result in to the outer puzzle, after our public key."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"cdv clsp curry outer-puzzle.clsp -a 0xb8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d -a '(a (q 2 (q 4 (c 2 (c 5 ())) 11) (c (q . 82) 1)) (c (q . 20) 1))'\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"(a (q 2 (q 2 10 (c 2 (c 5 (c 23 (c (a 11 23) ()))))) (c (q 50 (c (c 4 (c 5 (c (a 14 (c 2 (c 11 ()))) ()))) 23) 2 (i (l 5) (q 11 (q . 2) (a 14 (c 2 (c 9 ()))) (a 14 (c 2 (c 13 ())))) (q 11 (q . 1) 5)) 1) 1)) (c (q . 0xb8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d) (c (q 2 (q 2 (q 4 (c 2 (c 5 ())) 11) (c (q . 82) 1)) (c (q . 20) 1)) 1)))\n")),(0,c.kt)("admonition",{type:"info"},(0,c.kt)("p",{parentName:"admonition"},"Now that we curried in our public key, the bytecode will be different from key to key. Make sure you use your own key and prefix with 0x!")),(0,c.kt)("h2",{id:"create-the-coin"},"Create the Coin"),(0,c.kt)("p",null,"Now that we have curried the inner puzzle in to the outer puzzle, we will create a coin for our final outer puzzle bytecode."),(0,c.kt)("h1",{id:"get-puzzle-hash"},"Get Puzzle Hash"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'opc -H "<Outer Puzzle>"\n')),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'opc -H "(a (q 2 (q 2 10 (c 2 (c 5 (c 23 (c (a 11 23) ()))))) (c (q 50 (c (c 4 (c 5 (c (a 14 (c 2 (c 11 ()))) ()))) 23) 2 (i (l 5) (q 11 (q . 2) (a 14 (c 2 (c 9 ()))) (a 14 (c 2 (c 13 ())))) (q 11 (q . 1) 5)) 1) 1)) (c (q . 0xb8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d) (c (q 2 (q 2 (q 4 (c 2 (c 5 ())) 11) (c (q . 82) 1)) (c (q . 20) 1)) 1)))"\n')),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"e4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5\n")),(0,c.kt)("h1",{id:"get-puzzle-reveal"},"Get Puzzle Reveal"),(0,c.kt)("p",null,"While we are at it, let's also get our serialized puzzle for the ",(0,c.kt)("inlineCode",{parentName:"p"},"puzzle_reveal"),"."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'opc "<Outer Puzzle>"\n')),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'opc "(a (q 2 (q 2 10 (c 2 (c 5 (c 23 (c (a 11 23) ()))))) (c (q 50 (c (c 4 (c 5 (c (a 14 (c 2 (c 11 ()))) ()))) 23) 2 (i (l 5) (q 11 (q . 2) (a 14 (c 2 (c 9 ()))) (a 14 (c 2 (c 13 ())))) (q 11 (q . 1) 5)) 1) 1)) (c (q . 0xb8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d) (c (q 2 (q 2 (q 4 (c 2 (c 5 ())) 11) (c (q . 82) 1)) (c (q . 20) 1)) 1)))"\n')),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"ff02ffff01ff02ffff01ff02ff0affff04ff02ffff04ff05ffff04ff17ffff04ffff02ff0bff1780ff808080808080ffff04ffff01ff32ffff04ffff04ff04ffff04ff05ffff04ffff02ff0effff04ff02ffff04ff0bff80808080ff80808080ff1780ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff0effff04ff02ffff04ff09ff80808080ffff02ff0effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0b8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954dffff04ffff01ff02ffff01ff02ffff01ff04ffff04ff02ffff04ff05ff808080ff0b80ffff04ffff0152ff018080ffff04ffff0114ff018080ff01808080\n")),(0,c.kt)("h1",{id:"get-address"},"Get Address"),(0,c.kt)("p",null,"Now that we have our puzzle hash, we can encode this as an address."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"cdv encode -p txch e4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"txch1un74wmye6n9h3x3pkvtn6x8fzmphvdrjpj0vm8f97c2ayj73u0zsjqanlc\n")),(0,c.kt)("p",null,"We will use this address as the receive address for our new coin."),(0,c.kt)("h1",{id:"create-coin"},"Create Coin"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"chia wallet send --amount 0.01 --fee 0.00005 --address txch1un74wmye6n9h3x3pkvtn6x8fzmphvdrjpj0vm8f97c2ayj73u0zsjqanlc\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"Submitting transaction...\nTransaction submitted to nodes: [{'peer_id': '67095d445d879556da95feeee70174c66b131d4f29bd447df5fbc56789a01f24', 'inclusion_status': 'SUCCESS', 'error_msg': None}]\nRun 'chia wallet get_transaction -f 1660000549 -tx 0xcfc2382e19b8c02a251cc4092951aeda45d643d32fe9bbe675761a228a393b1a' to get status\n")),(0,c.kt)("p",null,"Let's get the status."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"chia wallet get_transaction -f 1660000549 -tx 0xcfc2382e19b8c02a251cc4092951aeda45d643d32fe9bbe675761a228a393b1a\n")),(0,c.kt)("p",null,"Eventually, this will say confirmed:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"Transaction cfc2382e19b8c02a251cc4092951aeda45d643d32fe9bbe675761a228a393b1a\nStatus: Confirmed\nAmount sent: 0.01 TXCH\nTo address: txch1un74wmye6n9h3x3pkvtn6x8fzmphvdrjpj0vm8f97c2ayj73u0zsjqanlc\nCreated at: 2022-11-01 22:34:50\n")),(0,c.kt)("p",null,"In the meantime, we can start crafting our ",(0,c.kt)("inlineCode",{parentName:"p"},"spendbundle.json"),":"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'{\n  "coin_spends": [\n    {\n      "coin": {\n        "amount": 10000000000,\n        "parent_coin_info": "",\n        "puzzle_hash": ""\n      },\n      "puzzle_reveal": "",\n      "solution": ""\n    }\n  ],\n  "aggregated_signature": ""\n}\n')),(0,c.kt)("p",null,"Next up, let's get the coin record and coin ID."),(0,c.kt)("h1",{id:"retreive-coin-info"},"Retreive Coin Info"),(0,c.kt)("p",null,"First, you can grab the coin by puzzlehash. If anyone has ever used the same CLVM for a coin, there will be multiple coins returned (this is unlikely since our puzzle included our own public key):"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"cdv rpc coinrecords --by puzzle_hash e4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "coin": {\n      "amount": 10000000000,\n      "parent_coin_info": "0xdb8e67eb6c0d91206329eb4fe53c403b3b0be29fdd99baa67e574c2318ade1f7",\n      "puzzle_hash": "0xe4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5"\n    },\n    "coinbase": false,\n    "confirmed_block_index": 333655,\n    "spent_block_index": 0,\n    "timestamp": 1667356550\n  }\n]\n')),(0,c.kt)("p",null,"This does not give the coin ID, but does give everything needed to calculate the coin ID."),(0,c.kt)("admonition",{type:"info"},(0,c.kt)("p",{parentName:"admonition"},"A coin ID is the hash of the parent coin ID, puzzle hash of the coin, and the amount.")),(0,c.kt)("p",null,"We can retrieve the coin ID with this template:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},'cdv inspect -id coins --parent-id "<Parent Coin Id>" --puzzle-hash "<Puzzle Hash>" --amount "<Amount>"\n')),(0,c.kt)("p",null,"Example:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"cdv inspect -id coins --parent-id 0x2ae27f44c228eeb9b16eb3f878c51e5bc468009eea79fce976e9d0a25b0e2b85 --puzzle-hash 0xaa0dc6276e519a604dd0a750b8efb53c5d65b55f189cc0ca29d498d45b69a216 --amount 10000000000\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"['43ab980558015de0d255b7eadf763feb9de22233bcdfde22b1c2823dfa2a53b5']\n")),(0,c.kt)("h2",{id:"crafting-a-solution"},"Crafting a solution"),(0,c.kt)("p",null,"The solution we will use is the same ",(0,c.kt)("inlineCode",{parentName:"p"},"51 CREATE_COIN")," condition we've been using throughout this series. To do this, we will need our wallet puzzle hash."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"chia wallet get_address\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"txch12zntse5ac4fl5nr83c43rcunjn9zr39r3a6z7zyu9c68ve949kpqkk5w9n\n")),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"cdv decode txch12zntse5ac4fl5nr83c43rcunjn9zr39r3a6z7zyu9c68ve949kpqkk5w9n\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"50a6b8669dc553fa4c678e2b11e39394ca21c4a38f742f089c2e347664b52d82\n")),(0,c.kt)("p",null,"Now, let's get the encoded solution:"),(0,c.kt)("admonition",{type:"warning"},(0,c.kt)("p",{parentName:"admonition"},"Remember 0x for your puzzle hash")),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'opc "((((51 0x50a6b8669dc553fa4c678e2b11e39394ca21c4a38f742f089c2e347664b52d82 9950000000))))"\n')),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"ffffffff33ffa050a6b8669dc553fa4c678e2b11e39394ca21c4a38f742f089c2e347664b52d82ff85025110f38080808080\n")),(0,c.kt)("p",null,"This is 4 parenthesis deep because the ",(0,c.kt)("inlineCode",{parentName:"p"},"outer-puzzle")," params list will be passed in surrounded by (), and one of those params is the inner solution, which is surrounded by (). Inside of the inner solution we have another set of () for the list of conditions where each condition is also surrounded by ()."),(0,c.kt)("p",null,"We will now calculate the ",(0,c.kt)("strong",{parentName:"p"},"hash for the inner solution"),", which is part of AGG_SIG_ME and will be neede for ",(0,c.kt)("inlineCode",{parentName:"p"},"chia keys sign"),":"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'opc -H "(((51 0x50a6b8669dc553fa4c678e2b11e39394ca21c4a38f742f089c2e347664b52d82 9950000000)))"\n')),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"e611d1b5035b2c77eb5a343d47d6c0f5345ae212539b666136ae86ccb95ee47a\n")),(0,c.kt)("p",null,"This will need signed with ",(0,c.kt)("inlineCode",{parentName:"p"},"chia keys sign"),", but ",(0,c.kt)("inlineCode",{parentName:"p"},"AGG_SIG_ME")," introduces some other inputs for a more unique signature. These are the coin ID and the genesis challenge."),(0,c.kt)("p",null,"We've already calculated the coin ID with ",(0,c.kt)("inlineCode",{parentName:"p"},"cdv inspect -id coins"),", now we just need the genesis challenge. The easiest way to retrieve this is with:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"chia show -s\n")),(0,c.kt)("p",null,"Now that we have all the pieces, we will concatenate them together for the final message to be signed."),(0,c.kt)("h1",{id:"concatenate-message"},"Concatenate Message"),(0,c.kt)("p",null,"The order for theses is solution hash, coin ID, genesis challenge."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"run '(concat 0xe611d1b5035b2c77eb5a343d47d6c0f5345ae212539b666136ae86ccb95ee47a 0x43ab980558015de0d255b7eadf763feb9de22233bcdfde22b1c2823dfa2a53b5 0xd25b25b897564035695996922aa0f9ff9d611bd38cd2ecd0d2383a99a70dfc15)'\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"0xe611d1b5035b2c77eb5a343d47d6c0f5345ae212539b666136ae86ccb95ee47a43ab980558015de0d255b7eadf763feb9de22233bcdfde22b1c2823dfa2a53b5d25b25b897564035695996922aa0f9ff9d611bd38cd2ecd0d2383a99a70dfc15\n")),(0,c.kt)("h1",{id:"sign-message"},"Sign Message"),(0,c.kt)("admonition",{type:"info"},(0,c.kt)("p",{parentName:"admonition"},"remove 0x from the message")),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-bash"},"chia keys sign --as-bytes --message  e611d1b5035b2c77eb5a343d47d6c0f5345ae212539b666136ae86ccb95ee47a43ab980558015de0d255b7eadf763feb9de22233bcdfde22b1c2823dfa2a53b5d25b25b897564035695996922aa0f9ff9d611bd38cd2ecd0d2383a99a70dfc15 --hd_path m\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"Public key: b8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954d\nSignature: 8c6154292b5215f96bbb664f6883bd4bd02db2f844ca99a9a82385ef1e1c983bbb3cf5e8191dc2627e4fd01236ef86c3158d6738f23875080d2bf3eec8caf316735e3851add2eb068dbfbc9c27327072ffbeb77ba26d371e3d6533b2033bc1bc\n")),(0,c.kt)("p",null,"Now, let's formulate the ",(0,c.kt)("inlineCode",{parentName:"p"},"spendbundle.json"),"."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "coin_spends": [\n    {\n      "coin": {\n        "amount": 10000000000,\n        "parent_coin_info": "0xdb8e67eb6c0d91206329eb4fe53c403b3b0be29fdd99baa67e574c2318ade1f7",\n        "puzzle_hash": "0xe4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5"\n      },\n      "puzzle_reveal": "ff02ffff01ff02ffff01ff02ff0affff04ff02ffff04ff05ffff04ff17ffff04ffff02ff0bff1780ff808080808080ffff04ffff01ff32ffff04ffff04ff04ffff04ff05ffff04ffff02ff0effff04ff02ffff04ff0bff80808080ff80808080ff1780ff02ffff03ffff07ff0580ffff01ff0bffff0102ffff02ff0effff04ff02ffff04ff09ff80808080ffff02ff0effff04ff02ffff04ff0dff8080808080ffff01ff0bffff0101ff058080ff0180ff018080ffff04ffff01b0b8f7dd239557ff8c49d338f89ac1a258a863fa52cd0a502e3aaae4b6738ba39ac8d982215aa3fa16bc5f8cb7e44b954dffff04ffff01ff02ffff01ff02ffff01ff04ffff04ff02ffff04ff05ff808080ff0b80ffff04ffff0152ff018080ffff04ffff0114ff018080ff01808080",\n      "solution": "ffffffff33ffa050a6b8669dc553fa4c678e2b11e39394ca21c4a38f742f089c2e347664b52d82ff85025110f38080808080"\n    }\n  ],\n  "aggregated_signature": "0x8c6154292b5215f96bbb664f6883bd4bd02db2f844ca99a9a82385ef1e1c983bbb3cf5e8191dc2627e4fd01236ef86c3158d6738f23875080d2bf3eec8caf316735e3851add2eb068dbfbc9c27327072ffbeb77ba26d371e3d6533b2033bc1bc"\n}\n')),(0,c.kt)("p",null,"Now, push the transaction:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"cdv rpc pushtx spendbundle.json\n")),(0,c.kt)("p",null,"If enough blocks have not gone through, it will say ",(0,c.kt)("inlineCode",{parentName:"p"},'"status": "PENDING"'),"."),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'{\n    "status": "SUCCESS",\n    "success": true\n}\n')),(0,c.kt)("p",null,"You can now see the spent block with the same command used earlier:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},"cdv rpc coinrecords --by puzzlehash 0xe4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5\n")),(0,c.kt)("p",null,"Response:"),(0,c.kt)("pre",null,(0,c.kt)("code",{parentName:"pre"},'[\n    {\n        "coin": {\n            "amount": 10000000000,\n            "parent_coin_info": "0xb74b97e934fdf0daa1ebc3aca5dd033f9b1ca9eb761140e108a8d113a420c6fe",\n            "puzzle_hash": "0xe4fd576c99d4cb789a21b3173d18e916c37634720c9ecd9d25f615d24bd1e3c5"\n        },\n        "coinbase": false,\n        "confirmed_block_index": 336196,\n        "spent_block_index": 336230,\n        "timestamp": 1667404639\n    }\n]\n')),(0,c.kt)("p",null,"As you can see, 34 blocks have passed in this example from coin creation to coin spend."))}u.isMDXComponent=!0}}]);